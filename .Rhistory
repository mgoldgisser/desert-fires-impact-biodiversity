dplyr::select(c("desert", "obsYear", "species"))
View(control_species)
summarize(count = ())
### get species info
control_species <- animals %>%
filter(treatmentGroup == "never burned") %>%
group_by(desert, obsYear, species) %>%
summarize(count = ())
### get species info
control_species <- animals %>%
filter(treatmentGroup == "never burned") %>%
group_by(desert, obsYear, species) %>%
summarize(count = ())
### get species info
control_species <- animals %>%
filter(treatmentGroup == "never burned") %>%
group_by(desert, obsYear, species) %>%
summarize(count = n())
### get species info
control_species <- animals %>%
filter(treatmentGroup == "never burned", obsYear > 1999) %>%
group_by(desert, obsYear, species) %>%
summarize(count = n())
burned <- burned %>%
filter(pre_or_post == "post") %>%
dplyr::select(c("desert", "obsYear", "fireYear", "species",
"yearsSinceFire")) %>%
mutate(count = 1)
burned <- animals %>%
filter(treatmentGroup == "burned") %>%
merge(.,sites[,c("fireID", "fireMonth")], by = "fireID") %>% #NEED to add fire months
mutate(yearsSinceFire = obsYear - fireYear,
pre_or_post = case_when(yearsSinceFire > 0 ~ "post",
yearsSinceFire < 0 ~ "pre",
yearsSinceFire == 0 ~ "SY"),
n_years = abs(yearsSinceFire))
#find pre- post- for observations in the same year and replace SY in datafire with pre or post
SY <- filter(burned, yearsSinceFire == 0) %>%
mutate(postingmonth = obsMonth - fireMonth,
pre_or_post = case_when(postingmonth >0 ~ "post",
postingmonth < 0 ~ "pre",
yearsSinceFire == 0 ~ "SM"))
burned$pre_or_post <- ifelse(burned$pre_or_post == "SY", SY$pre_or_post, burned$pre_or_post)
unique(burned$pre_or_post) #check if any SM (same month); would need to further categorize
burned <- burned %>%
filter(pre_or_post == "post") %>%
dplyr::select(c("desert", "obsYear", "fireYear", "species",
"yearsSinceFire")) %>%
mutate(count = 1)
burned <- burned %>%
filter(pre_or_post == "post") %>%
dplyr::select(c("desert", "obsYear", "species", "yearsSinceFire")) %>%
mutate(count = 1)
burned <- animals %>%
filter(treatmentGroup == "burned") %>%
merge(.,sites[,c("fireID", "fireMonth")], by = "fireID") %>% #NEED to add fire months
mutate(yearsSinceFire = obsYear - fireYear,
pre_or_post = case_when(yearsSinceFire > 0 ~ "post",
yearsSinceFire < 0 ~ "pre",
yearsSinceFire == 0 ~ "SY"),
n_years = abs(yearsSinceFire))
#find pre- post- for observations in the same year and replace SY in datafire with pre or post
SY <- filter(burned, yearsSinceFire == 0) %>%
mutate(postingmonth = obsMonth - fireMonth,
pre_or_post = case_when(postingmonth >0 ~ "post",
postingmonth < 0 ~ "pre",
yearsSinceFire == 0 ~ "SM"))
burned$pre_or_post <- ifelse(burned$pre_or_post == "SY", SY$pre_or_post, burned$pre_or_post)
unique(burned$pre_or_post) #check if any SM (same month); would need to further categorize
burned <- burned %>%
filter(pre_or_post == "post") %>%
dplyr::select(c("desert", "obsYear", "species", "yearsSinceFire")) %>%
mutate(count = 1)
### get fire years to make control
fireYear <- burned %>%
group_by(fireYear, desert) %>%
summarize(total = n()) %>%
dplyr::select(-total)
burned <- animals %>%
filter(treatmentGroup == "burned") %>%
merge(.,sites[,c("fireID", "fireMonth")], by = "fireID") %>% #NEED to add fire months
mutate(yearsSinceFire = obsYear - fireYear,
pre_or_post = case_when(yearsSinceFire > 0 ~ "post",
yearsSinceFire < 0 ~ "pre",
yearsSinceFire == 0 ~ "SY"),
n_years = abs(yearsSinceFire))
#find pre- post- for observations in the same year and replace SY in datafire with pre or post
SY <- filter(burned, yearsSinceFire == 0) %>%
mutate(postingmonth = obsMonth - fireMonth,
pre_or_post = case_when(postingmonth >0 ~ "post",
postingmonth < 0 ~ "pre",
yearsSinceFire == 0 ~ "SM"))
burned$pre_or_post <- ifelse(burned$pre_or_post == "SY", SY$pre_or_post, burned$pre_or_post)
unique(burned$pre_or_post) #check if any SM (same month); would need to further categorize
burned <- burned %>%
filter(pre_or_post == "post") %>%
dplyr::select(c("desert", "obsYear", "fireYear", "species",
"yearsSinceFire")) %>%
mutate(count = 1)
### get fire years to make control
fireYear <- burned %>%
group_by(fireYear, desert) %>%
summarize(total = n()) %>%
dplyr::select(-total)
### get species info
control_species <- animals %>%
filter(treatmentGroup == "never burned", obsYear > 1999) %>%
group_by(desert, obsYear, species) %>%
summarize(count = 1)
### get species info
control_species <- animals %>%
filter(treatmentGroup == "never burned", obsYear > 1999) %>%
group_by(desert, obsYear, species) %>%
summarize(count = n())
### make control
control <- burned %>% group_by(desert, fireYear) %>%
summarize(maxTime = max(yearsSinceFire))
## vectors for control df
yearsSinceFire <- c()
desert <- c()
fireYear <- c()
for (i in 1:nrow(control)) {
yearsSinceFire <-  c(yearsSinceFire, rep(1:control$maxTime[i], 1))
}
#### test, test, can anyone hear me?
test1 <- control_species %>% dplyr::select(c(desert, obsYear, species))
test2 <- burned %>% dplyer::select(c(desert, obsYear, species))
test2 <- burned %>% dplyr::select(c(desert, obsYear, species))
test3 <- intersect(test1, test2)
View(test3)
View(test1)
View(test2)
test2 <- data.frama(A = c(a, b, d, d, e, e),
Num = c(1, 1, 1, 1, 1, 2))
test1 <- data.frama(A = c(a, b, c, d, d, e, e),
Num = c(1, 1, 1, 1, 2, 1, 2))
test1 <- data.frame(A = c(a, b, c, d, d, e, e),
Num = c(1, 1, 1, 1, 2, 1, 2))
test1 <- data.frame(A = c(a, b, c, d, d, e, e),
Num = c(1, 1, 1, 1, 2, 1, 2))
test1 <- data.frame(A = c("a", "b", "c", "d", "d", "e", "e"),
Num = c(1, 1, 1, 1, 2, 1, 2))
test2 <- data.frame(A = c("a", "b", "d", "d", "e", "e"),
Num = c(1, 1, 1, 1, 1, 2))
test3 <- intersect(test1, test2)
View(test3)
test2 <- data.frame(A = c("a", "b", "d", "d", "e", "e", "f"),
Num = c(1, 1, 1, 1, 1, 2, 2))
test3 <- intersect(test1, test2)
print(test3)
test1 <- data.frame(x1 = c(2, 3, 4),
x2 = c(1, 1, 1))
test2 <- data.frame(y1 = c(2, 3, 4),
y2 = c(2, 2, 2))
test3 <- intersect(test1, test2)
print(test3)
test2 <- data.frame(A = c("a", "b", "c" "d", "d", "e", "e"),
Num = c(1, 1, 1, 1, 1, 2, 2))
test2 <- data.frame(A = c("a", "b", "c" "d", "d", "e", "e"),
Num = c(1, 1, 1, 1, 1, 2, 2))
test1 <- data.frame(A = c("a", "b", "c", "d", "d", "e", "e"),
Num = c(1, 1, 1, 1, 2, 1, 2))
test2 <- data.frame(A = c("a", "b", "c", "d", "d", "e", "e"),
Num = c(1, 1, 1, 1, 1, 2, 2))
test3 <- intersect(test1, test2)
print(test3)
test3 <- all_equal(test1, test2)
print(test3)
test1 <- data.frame(A = c("a", "b", "c", "d", "d", "e", "e"),
Num = c(1, 1, 1, 1, 2, 2, 2))
test3 <- all_equal(test1, test2)
test1 <- data.frame(A = c("a", "b", "c", "d", "d", "e"),
Num = c(1, 1, 1, 1, 2, 2))
test2 <- data.frame(A = c("a", "b", "c", "d", "d", "e", "e"),
Num = c(1, 1, 1, 1, 1, 2, 2))
test3 <- all_equal(test1, test2)
print(test3)
#### test, test, can anyone hear me?
test1 <- control_species %>% dplyr::select(c(desert, obsYear, species))
test2 <- burned %>% dplyr::select(c(desert, obsYear, species))
test3 <- anti_join(test1, test2)
View(test3)
test3 <- anti_join(test2, test1)
test1 <- data.frame(A = c("a", "b", "c", "d", "d", "e"),
Num = c(1, 1, 1, 1, 2, 2))
test2 <- data.frame(A = c("a", "b", "c", "d", "d", "e", "e"),
Num = c(1, 1, 1, 1, 1, 2, 2))
test3 <- anti_join(test2, test1)
test3 <- anti_join(test1, test2)
print(test3)
control_sp_total <- control_species %>%
group_by(desert, obsYear, species) %>%
summarize(count = n())
View(control_sp_total)
control_sp_total <- control_species %>%
group_by(desert, obsYear) %>%
summarize(count = n())
for (i in 1:nrow(control)) {
yearsSinceFire <-  c(yearsSinceFire, rep(1:control$maxTime[i], 1))
}
for (i in 1:nrow(control)) {
desert <-  c(desert, rep(control$desert[i], each = control$maxTime[i]))
}
for (i in 1:nrow(control)) {
fireYear <-  c(fireYear, rep(control$fireYear[i], each = control$maxTime[i]))
}
control <- data.frame(desert, fireYear, yearsSinceFire) %>%
mutate(obsYear = fireYear + yearsSinceFire) %>%
filter(obsYear < 2021) %>%
left_join(., dplyr::select(control_species, -count), by = c("obsYear", "desert"))
## vectors for control df
yearsSinceFire <- c()
for (i in 1:nrow(control)) {
yearsSinceFire <-  c(yearsSinceFire, rep(1:control$maxTime[i], 1))
}
for (i in 1:nrow(control)) {
desert <-  c(desert, rep(control$desert[i], each = control$maxTime[i]))
}
## vectors for control df
yearsSinceFire <- c()
desert <- c()
fireYear <- c()
for (i in 1:nrow(control)) {
yearsSinceFire <-  c(yearsSinceFire, rep(1:control$maxTime[i], 1))
}
for (i in 1:nrow(control)) {
desert <-  c(desert, rep(control$desert[i], each = control$maxTime[i]))
}
for (i in 1:nrow(control)) {
fireYear <-  c(fireYear, rep(control$fireYear[i], each = control$maxTime[i]))
}
print(yearsSinceFire)
control$maxTime[1]
rep(control$desert[1], each = control$maxTime[1])
print(fireYear)
data.frame(fireYear, yearsSinceFire)
data.frame(yearsSinceFire, fireYear)
fireYear <- c(fireYear, c(9999, 9999))
data.frame(yearsSinceFire, fireYear)
### make control
control <- burned %>% group_by(desert, fireYear) %>%
summarize(maxTime = max(yearsSinceFire)) %>%
filter(maxTime != 0)
## vectors for control df
yearsSinceFire <- c()
desert <- c()
fireYear <- c()
for (i in 1:nrow(control)) {
yearsSinceFire <-  c(yearsSinceFire, rep(1:control$maxTime[i], 1))
}
for (i in 1:nrow(control)) {
desert <-  c(desert, rep(control$desert[i], each = control$maxTime[i]))
}
for (i in 1:nrow(control)) {
fireYear <-  c(fireYear, rep(control$fireYear[i], each = control$maxTime[i]))
}
control <- data.frame(desert, fireYear, yearsSinceFire) %>%
mutate(obsYear = fireYear + yearsSinceFire) %>%
filter(obsYear < 2021) %>%
left_join(., dplyr::select(control_species, -count), by = c("obsYear", "desert"))
control <- data.frame(desert, fireYear, yearsSinceFire) %>%
mutate(obsYear = fireYear + yearsSinceFire) %>%
filter(obsYear < 2021) %>%
full_join(., dplyr::select(control_species, -count), by = c("obsYear", "desert"))
print(fireYear)
### make control
control_test <- burned %>% group_by(desert, fireYear) %>%
summarize(maxTime = max(yearsSinceFire)) %>%
filter(maxTime != 0)
View(control_test)
control <- data.frame(desert, fireYear, yearsSinceFire) %>%
mutate(obsYear = fireYear + yearsSinceFire) %>%
filter(obsYear < 2021) %>%
left_join(., dplyr::select(control_species, -count), by = c("obsYear", "desert"))
View(burned)
View(burned)
burned <- burned %>%
filter(pre_or_post == "post") %>%
dplyr::select(c("desert", "obsYear", "fireYear", "species",
"yearsSinceFire")) %>%
mutate(count = 1) %>%
mutate(yearsSinceFire = ifelse(yearsSinceFire == 0, 1, yearsSinceFire))
burned <- animals %>%
filter(treatmentGroup == "burned") %>%
merge(.,sites[,c("fireID", "fireMonth")], by = "fireID") %>% #NEED to add fire months
mutate(yearsSinceFire = obsYear - fireYear,
pre_or_post = case_when(yearsSinceFire > 0 ~ "post",
yearsSinceFire < 0 ~ "pre",
yearsSinceFire == 0 ~ "SY"),
n_years = abs(yearsSinceFire))
#find pre- post- for observations in the same year and replace SY in datafire with pre or post
SY <- filter(burned, yearsSinceFire == 0) %>%
mutate(postingmonth = obsMonth - fireMonth,
pre_or_post = case_when(postingmonth >0 ~ "post",
postingmonth < 0 ~ "pre",
yearsSinceFire == 0 ~ "SM"))
burned$pre_or_post <- ifelse(burned$pre_or_post == "SY", SY$pre_or_post, burned$pre_or_post)
unique(burned$pre_or_post) #check if any SM (same month); would need to further categorize
burned <- burned %>%
filter(pre_or_post == "post") %>%
dplyr::select(c("desert", "obsYear", "fireYear", "species",
"yearsSinceFire")) %>%
mutate(count = 1) %>%
mutate(yearsSinceFire = ifelse(yearsSinceFire == 0, 1, yearsSinceFire))
burned <- burned %>% group_by(desert, yearsSinceFire, species) %>%
summarize(count = n()) %>%
dplyr::select(-count)
burned <- animals %>%
filter(treatmentGroup == "burned") %>%
merge(.,sites[,c("fireID", "fireMonth")], by = "fireID") %>% #NEED to add fire months
mutate(yearsSinceFire = obsYear - fireYear,
pre_or_post = case_when(yearsSinceFire > 0 ~ "post",
yearsSinceFire < 0 ~ "pre",
yearsSinceFire == 0 ~ "SY"),
n_years = abs(yearsSinceFire))
#find pre- post- for observations in the same year and replace SY in datafire with pre or post
SY <- filter(burned, yearsSinceFire == 0) %>%
mutate(postingmonth = obsMonth - fireMonth,
pre_or_post = case_when(postingmonth >0 ~ "post",
postingmonth < 0 ~ "pre",
yearsSinceFire == 0 ~ "SM"))
burned$pre_or_post <- ifelse(burned$pre_or_post == "SY", SY$pre_or_post, burned$pre_or_post)
unique(burned$pre_or_post) #check if any SM (same month); would need to further categorize
burned <- burned %>%
filter(pre_or_post == "post") %>%
dplyr::select(c("desert", "obsYear", "fireYear", "species",
"yearsSinceFire")) %>%
mutate(count = 1) %>%
mutate(yearsSinceFire = ifelse(yearsSinceFire == 0, 1, yearsSinceFire))
burned <- burned %>% group_by(desert, yearsSinceFire, species) %>%
summarize(count = n())
burned <- burned %>% group_by(desert, yearsSinceFire, species) %>%
summarize(count = n()) %>%
dplyr::select(-count)
control <- control %>% group_by(desert, yearsSinceFire, species) %>%
summarize(count = n()) %>%
dplyr::select(-count)
unique_b <- anti_join(burned, control)
unique_b <- anti_join(burned, control)
unique_c <- anti_join(control, burned)
print(unique_b)
View(unique_c)
View(unique_c)
View(unique_c)
View(unique_c)
View(unique_c)
unique_b <- unique_b %>% group_by(desert, yearsSinceFire) %>%
summarize(sp_total = n())
View(unique_b)
View(unique_b)
unique_c <- unique_c %>% group_by(desert, yearsSinceFire) %>%
summarize(sp_total = n())
View(unique_c)
View(unique_c)
View(unique_c)
shared <- anti_join(burned, anti_join(burned, control))
unique_c <- anti_join(control, burned)
View(shared)
shared <- anti_join(burned, anti_join(burned, control)) %>%
group_by(desert, yearsSinceFire) %>%
summarize(sp_total = n())
View(shared)
unique_b <- anti_join(burned, control) %>%
group_by(desert, yearsSinceFire) %>%
summarize(unique_b = n())
unique_c <- anti_join(control, burned) %>%
group_by(desert, yearsSinceFire) %>%
summarize(unique_c = n())
shared <- anti_join(burned, anti_join(burned, control)) %>%
group_by(desert, yearsSinceFire) %>%
summarize(shared = n())
tsf_df <- full_join(shared, unique_b, unique_c, by = c("desert", "yearsSinceFire"))
View(tsf_df)
tsf_df <- full_join(shared, unique_b, by = c("desert", "yearsSinceFire")) %>%
full_join(., unique_c, by = c("desert", "yearsSinceFire"))
View(tsf_df)
View(tsf_df)
tsf_df <- full_join(shared, unique_b, by = c("desert", "yearsSinceFire")) %>%
full_join(., unique_c, by = c("desert", "yearsSinceFire")) %>%
mutate(unique_b = ifelse(is.na(unique_b), 0, unique_b))
tsf_df <- full_join(shared, unique_b, by = c("desert", "yearsSinceFire")) %>%
full_join(., unique_c, by = c("desert", "yearsSinceFire")) %>%
mutate(unique_b = ifelse(is.na(unique_b), 0, unique_b),
shared = ifelse(is.na(shared), 0, shared),
unique_c = ifelse(is.na(unique_c), 0, unique_c),
si = (2*shared)/(unique_b + unique_c))
ggplot(data = tsf_df, aes(x = yearsSinceFire, y = si, color = desert)) +
geom_point() +
geom_smooth()
ggplot(data = tsf_df, aes(x = yearsSinceFire, y = si, color = desert)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE)
ggplot(data = tsf_df, aes(x = yearsSinceFire, y = si, color = desert)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE) +
y_lab("Sorensen's Similarity Index")
ggplot(data = tsf_df, aes(x = yearsSinceFire, y = si, color = desert)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE) +
ylab("Sorensen's Similarity Index")
###data for over-time for burned sites
burned <- animals %>%
filter(treatmentGroup == "burned") %>%
merge(.,sites[,c("fireID", "fireMonth")], by = "fireID") %>% #NEED to add fire months
mutate(yearsSinceFire = obsYear - fireYear,
pre_or_post = case_when(yearsSinceFire > 0 ~ "post",
yearsSinceFire < 0 ~ "pre",
yearsSinceFire == 0 ~ "SY"),
n_years = abs(yearsSinceFire))
#find pre- post- for observations in the same year and replace SY in datafire with pre or post
SY <- filter(burned, yearsSinceFire == 0) %>%
mutate(postingmonth = obsMonth - fireMonth,
pre_or_post = case_when(postingmonth >0 ~ "post",
postingmonth < 0 ~ "pre",
yearsSinceFire == 0 ~ "SM"))
burned$pre_or_post <- ifelse(burned$pre_or_post == "SY", SY$pre_or_post, burned$pre_or_post)
unique(burned$pre_or_post) #check if any SM (same month); would need to further categorize
burned <- burned %>%
filter(pre_or_post == "post") %>%
dplyr::select(c("desert", "obsYear", "fireYear", "species",
"yearsSinceFire")) %>%
mutate(count = 1) %>%
mutate(yearsSinceFire = ifelse(yearsSinceFire == 0, 1, yearsSinceFire))
### get fire years to make control
fireYear <- burned %>%
group_by(fireYear, desert) %>%
summarize(total = n()) %>%
dplyr::select(-total)
### make control
control_test <- burned %>% group_by(desert, fireYear) %>%
summarize(maxTime = max(yearsSinceFire)) %>%
filter(maxTime != 0)
### get species info for control
control_species <- animals %>%
filter(treatmentGroup == "never burned", obsYear > 1999) %>%
group_by(desert, obsYear, species) %>%
summarize(count = n())
### how many species each year in control?
control_sp_total <- control_species %>%
group_by(desert, obsYear) %>%
summarize(count = n())
## vectors for control df
yearsSinceFire <- c()
desert <- c()
fireYear <- c()
for (i in 1:nrow(control)) {
yearsSinceFire <-  c(yearsSinceFire, rep(1:control$maxTime[i], 1))
}
###data for over-time for burned sites
burned <- animals %>%
filter(treatmentGroup == "burned") %>%
merge(.,sites[,c("fireID", "fireMonth")], by = "fireID") %>% #NEED to add fire months
mutate(yearsSinceFire = obsYear - fireYear,
pre_or_post = case_when(yearsSinceFire > 0 ~ "post",
yearsSinceFire < 0 ~ "pre",
yearsSinceFire == 0 ~ "SY"),
n_years = abs(yearsSinceFire))
library(tidyverse)
library(mgcv)
library(sf)
#library(lwgeom)
library(lme4)
library(ggsci)
#library(ggrepel)
library(stats)
#library(broom)
#library(gghighlight)
library(gamm4)
#library(MuMIn)
library(cowplot)
library(MASS) #for glm.nb
library(pscl) #for zero-inflated glm
library(lmtest) #for lrtest: likelihood test of nested models
library(VGAM) #for zero-truncated models
library(countreg) #for zero-truncated models
library(glmmTMB) #glmm with zero-truncated nb
library(DHARMa) #diagnostic for mixed regression models
library(emmeans)
library(remote)
setwd("~/GitHub/desert-fires-impact-biodiversity")
sm_mam <- c("Ammospermophilus", "Xerospermophilus", "Dipodomys", "Vulpes")
raptors  <- c("Accipitriformes", 'Pelecaniformes', "Strigiformes", "Falconiformes")
animals <- st_read("shapefiles/animals/animals_51022.shp") %>%
st_drop_geometry() %>%
rename(obsID = TARGET_FID, order = order_,
individualCount = individual, obsDay = day,
obsMonth = month, obsYear = year,
institutionalCode = institutio,
treatmentGroup = treatmentG, fireName = INCIDENT,
fireYear = FIRE_YEARn, fireSize = GISAcres) %>%
dplyr::select(-c("verbatimSc", "issue", "coordinate", 'nearRd_FID', "nearUA_FID",
'basisOfRec', 'institutionalCode', 'collection', 'recordedBy', 'nearRdDist', 'nearUADist')) %>%
filter(obsYear > 1994, obsYear < 2021, species != "Canis lupus", species != "Balaenoptera musculus",
species != "Grus canadensis", treatmentGroup != "burned prior 2000") %>%
mutate(funcGroup =
ifelse(genus == "Puma" | genus == "Ovis", "Large Mammals",
ifelse(genus == "Branchinecta" | genus == "Cyprinodon", "Aquatic",
ifelse(genus == "Dinacoma", "Beetles",
ifelse(genus == "Bombus", "Bees",
ifelse(genus == "Gopherus", "Tortoises",
ifelse(genus == "Danaus" | genus == "Euproserpinus", "Butterflies & Moths",
ifelse(genus == "Rana" | genus == "Anaxyrus","Frogs and Toads",
ifelse(genus == "Ambystoma" | genus == "Batrachoseps", "Salamanders",
ifelse(genus == "Coleonyx" | genus == "Gambelia" | genus == "Uma", "Lizards and Geckos",
ifelse(genus %in% sm_mam, "Small Mammals",
ifelse(order %in% raptors, "Birds:Raptors",
ifelse(order == "Passeriformes", "Birds:Passerines",
ifelse(order == "Piciformes", "Birds:Woodpeckers",
ifelse(order == "Gruiformes" | order == "Anseriformes", "Birds:Rails and Geese", "ERROR"
)))))))))))))),
ez_taxa = ifelse(class=='Aves', 'Aves', 'Other'),
individualCount = ifelse(individualCount == 0, 1, individualCount))
