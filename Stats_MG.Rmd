---
title: "Untitled"
author: "Marina"
date: "10/7/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)

setwd("~/GitHub/desert-fires-impact-biodiversity")

```

### Load libraries and data

```{r}
library(tidyverse)
library(skimr)

sites <- read_csv("data/sites.csv")
observations <- read_csv("data/observations.csv")

data <- left_join(observations, sites, by = "fireID")

head(data)

```

## Pre-/Post- value

To compare observation before a fire and after a fire, create a pre-/post- column that identifies the observation as occuring either before a fire or after a fire. 

"postingvalue" = obsYear - fireYear
"pre_or_post" = if postingvalue is negative = pre; positive = post; 0 = SY\
those in the same year will be further catergorized by comparing the month of the observation.
"n_years" = absolute value of years between observation and fire



```{r}
data <- data %>% 
  mutate(postingvalue = obsYear - fireYear, 
         pre_or_post = case_when(postingvalue > 0 ~ "post",
                                 postingvalue < 0 ~ "pre",
                                 postingvalue == 0 ~ "SY"),
         n_years = abs(postingvalue))
  
#find pre- post- for observations in the same year and replace SY in datafire with pre or post
SY <- filter(data, postingvalue == 0) %>% 
  mutate(postingmonth = month - firemonth,
    pre_or_post = case_when(postingmonth >0 ~ "post",
                            postingmonth < 0 ~ "pre",
                            postingvalue == 0 ~ "SM"))

data$pre_or_post <- ifelse(data$pre_or_post == "SY", SY$pre_or_post, data$pre_or_post)

unique(data$pre_or_post) #check if any SM (same month); would need to further categorize

```

```{r}
skim(data)
```



## Is there a difference in observations between species?

The following graphs explore whether there is a difference between species observations before and after a fire.

Note: only bird data is reported with individual counts. Non-avian data is simply reported as presence/absence.


```{r}
count(data, species, wt = indvdlC)

count(data, species)

sp_pre_post <- group_by(data, species, pre_or_post) %>% 
  count(species)

sp_pre_post_weighted <- group_by(data, species, pre_or_post) %>% 
  count(species, wt = indvdlC)

sp_pre_post_wt_minusAt <- group_by(data, species, pre_or_post) %>% 
  count(species, wt = indvdlC) %>% 
  filter(species != "Agelaius tricolor")

ggplot(sp_pre_post, aes (pre_or_post, n)) +
  geom_col(aes(fill = pre_or_post)) +
  scale_fill_manual(values = c("firebrick3", "gray50")) +
  scale_x_discrete(limits = c("pre", "post")) +
  facet_wrap(vars(species))

ggplot(sp_pre_post_weighted, aes (pre_or_post, n)) +
  geom_col(aes(fill = pre_or_post)) +
  scale_fill_manual(values = c("firebrick3", "gray50")) +
  scale_x_discrete(limits = c("pre", "post")) +
  facet_wrap(vars(species))

ggplot(sp_pre_post_wt_minusAt, aes (pre_or_post, n)) +
  geom_col(aes(fill = pre_or_post)) +
  scale_fill_manual(values = c("firebrick3", "gray50")) +
  scale_x_discrete(limits = c("pre", "post")) +
  facet_wrap(vars(species))

```


